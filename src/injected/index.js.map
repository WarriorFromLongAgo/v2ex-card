{"version":3,"file":"index.js","sources":["../../node_modules/_@babel_runtime@7.11.2@@babel/runtime/helpers/classCallCheck.js","../../node_modules/_@babel_runtime@7.11.2@@babel/runtime/helpers/createClass.js","../share/index.js","dev/index.js"],"sourcesContent":["function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nmodule.exports = _classCallCheck;","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nmodule.exports = _createClass;","export function sleep(ms = 0) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n}\n\nexport function debounce(func, wait, context) {\n    let timeout;\n    return function fn(...args) {\n        const later = function later() {\n            timeout = null;\n            func.apply(context, args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    };\n}\n","import './index.scss';\nimport { debounce } from '../../share';\n\nclass Injected {\n    constructor() {\n        this.infoCache = {};\n        this.domParser = new DOMParser();\n\n        const onMouseMoveDebounce = debounce(this.onMouseMove.bind(this), 300);\n        document.body.addEventListener('mousemove', onMouseMoveDebounce);\n    }\n\n    getMemberUrl(event) {\n        const $el = event.target;\n        const reg = /^\\/member\\//;\n        if ($el.tagName === 'A' && reg.test($el.pathname || '')) {\n            return $el.pathname;\n        }\n        if ($el.tagName === 'IMG' && $el.className === 'avatar' && $el.alt) {\n            return `/member/${$el.alt}`;\n        }\n        return null;\n    }\n\n    getInfoFromText(text) {\n        const dom = this.domParser.parseFromString(text, 'text/html');\n        const $avatar = dom.querySelector('.avatar');\n        const $summary = dom.querySelector('#Main .box .gray');\n        const name = $avatar.alt;\n        const avatar = $avatar.src;\n        const joinRank = $summary.textContent.match(/\\s(\\d+)\\s/)[1];\n        const joinTime = $summary.textContent.match(/\\s(\\d{4}-.*\\+08:00)/)[1];\n        const $activity = $summary.querySelector('a');\n        const activityRank = $activity ? $activity.textContent : '';\n        return {\n            name,\n            avatar,\n            joinRank,\n            joinTime,\n            activityRank,\n            socials: [],\n            topics: [],\n        };\n    }\n\n    getMemberInfo(memberUrl) {\n        if (this.infoCache[memberUrl]) {\n            return Promise.resolve(this.infoCache[memberUrl]);\n        }\n        return fetch(memberUrl)\n            .then((res) => res.text())\n            .then((text) => {\n                this.infoCache[memberUrl] = this.getInfoFromText(text);\n                return this.infoCache[memberUrl];\n            });\n    }\n\n    render(event, memberInfo) {\n        console.log(event, memberInfo);\n    }\n\n    onMouseMove(event) {\n        const memberUrl = this.getMemberUrl(event);\n        if (memberUrl) {\n            this.getMemberInfo(memberUrl)\n                .then((memberInfo) => {\n                    this.render(event, memberInfo);\n                })\n                .catch((err) => {\n                    console.warn(err);\n                });\n        }\n    }\n}\n\nexport default new Injected();\n"],"names":["debounce","func","wait","context","timeout","fn","args","later","apply","clearTimeout","setTimeout","Injected","infoCache","domParser","DOMParser","onMouseMoveDebounce","onMouseMove","bind","document","body","addEventListener","event","$el","target","reg","tagName","test","pathname","className","alt","text","dom","parseFromString","$avatar","querySelector","$summary","name","avatar","src","joinRank","textContent","match","joinTime","$activity","activityRank","socials","topics","memberUrl","Promise","resolve","fetch","then","res","getInfoFromText","memberInfo","console","log","getMemberUrl","getMemberInfo","render","err","warn"],"mappings":"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"}